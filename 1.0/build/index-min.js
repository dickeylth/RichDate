/*! RichDate - v1.0 - 2013-09-06 6:38:06 PM
* Copyright (c) 2013 hongshu; Licensed  */
KISSY.add("gallery/RichDate/1.0/index",function(a){function b(a){return{year:a.getFullYear(),month:a.getMonth()+1,date:a.getDate(),hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()}}function c(a){return new Date(a.year,a.month-1,a.date,a.hour,a.minute,a.second)}function d(a){return 0==a%4&&0!=a%100||0==a%400?!0:!1}function e(b){var e=!0;b.isLeapYear=d(b.year);var f=31;return a.inArray(b.month,g)?f=30:2==b.month&&(f=b.isLeapYear?29:28),k.date[1]=f,a.each(k,function(a,c){return a[0]>b[c]||a[1]<b[c]?(e=!1,!1):void 0}),e&&c(b)}function f(d,e,f){var g=b(d),i=/^((\d)+[YMDhms]{1})+$/;if(a.isString(e)&&i.test(e)){for(var j,k=/(\d)+[YMDhms]{1}/g;null!=(j=k.exec(e));){var l=j[0],m=parseInt(l),n=l[l.length-1];f?g[h[n]]+=m:g[h[n]]-=m}return c(g)}a.error("invalid interval string, please set as '2Y','2M','2D','2h','2m','2s' with their combination!")}var g=[4,6,9,11],h={Y:"year",M:"month",D:"date",h:"hour",m:"minute",s:"second"},i=a.keys(h),j={year:0,month:0,date:0,hour:0,minute:0,second:0},k={year:[1,9999],month:[1,12],date:[1,31],hour:[0,60],minute:[0,60],second:[0,60]};a.mix(Date,{parseBy:function(b,c){b=a.trim(b),c=a.trim(c);var d=!0,f=!0,g="Date parse failed, please check and retry!";if(b&&c){for(var k=0,l=0,m=c.length;m>k&&d;k++,l++){var n=c.charAt(k),o=b.charAt(l);if(a.inArray(n,i))if("YYYY"==c.substr(k,4)){var p=parseInt(b.substr(l,4));if(!isNaN(p)){j.year=p,k+=3,l+=3;continue}d=!1}else if(n==c.charAt(k+1)){var q=parseInt(b.substr(l,2));if(!(isNaN(q)||0>q)){j[h[n]]=q,"0"==b[l]&&l++,k++;continue}d=!1}if(!d||n!=o)return a.log(g),!1}return f=e(j),f||a.log(g),f}return a.log(g),!1}}),a.mix(Date.prototype,{isLeapYear:function(){return d(this.getFullYear())},before:function(a){return f(this,a,!1)},after:function(a){return f(this,a,!0)},formatAs:function(c){var d=arguments[1]||!1,e=b(this),f="";if(a.isString(c))for(var g=0;g<c.length;g++){var j=c.charAt(g);if(a.inArray(j,i))if("YYYY"==c.substr(g,4))f+=e.year,g+=3;else if(j==c.charAt(g+1)){var k=e[h[j]];d&&10>k&&(k="0"+k),f+=k,g++}else f+=j;else f+=j}return f}})});